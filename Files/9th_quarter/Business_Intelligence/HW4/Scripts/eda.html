<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BigMart Analytics - EDA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Home Button Styles */
        .home-button {
            position: fixed;
            top: 2rem;
            left: 2rem;
            z-index: 100;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50px;
            padding: 0.8rem 1.5rem;
            color: #667eea;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            animation: slideIn 0.8s ease-out;
        }

        .home-button:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .home-button:active {
            transform: translateY(0);
        }

        .fade-in {
            animation: fadeIn 0.6s ease-in;
        }
        
        .delay-1 {
            animation-delay: 0.2s;
            opacity: 0;
            animation-fill-mode: forwards;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .info-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 1.5rem;
            border-radius: 1rem;
            color: white;
            transition: transform 0.3s ease;
        }
        
        .info-card:hover {
            transform: translateY(-5px);
        }
        
        .carousel-container {
            position: relative;
            overflow: hidden;
            border-radius: 1rem;
            background: white;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .carousel-track {
            display: flex;
            transition: transform 0.5s ease-in-out;
        }
        
        .carousel-slide {
            min-width: 100%;
            padding: 2rem;
        }
        
        .carousel-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: white;
            border: none;
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 10;
        }
        
        .carousel-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-50%) scale(1.1);
        }
        
        .carousel-btn.prev {
            left: 1rem;
        }
        
        .carousel-btn.next {
            right: 1rem;
        }
        
        .slide-indicator {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            padding: 1.5rem 0;
        }
        
        .indicator-dot {
            width: 0.75rem;
            height: 0.75rem;
            border-radius: 50%;
            background: #d1d5db;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .indicator-dot.active {
            background: #667eea;
            width: 2rem;
            border-radius: 0.375rem;
        }
        
        .chart-container {
            background: white;
            border-radius: 0.5rem;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100">
    <header class="bg-white/95 backdrop-blur-sm shadow-lg fixed w-full top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center">
                        <i class="fas fa-chart-line text-white text-lg"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-900">BigMart Analytics</h1>
                        <p class="text-xs text-gray-600">Exploratory Analysis</p>
                    </div>
                </div>

                <nav class="hidden md:flex space-x-8">
                    <a href="/business-intelligence/bigmart-analisys" class="nav-link text-gray-700 font-medium hover:text-indigo-600 transition-colors">Overview</a>
                    <a href="" class="nav-link text-indigo-600 font-medium">EDA</a>
                    <a href="/business-intelligence/bigmart-analisys/modeling" class="nav-link text-gray-700 font-medium hover:text-indigo-600 transition-colors">Modeling</a>
                    <a href="/business-intelligence/bigmart-analisys/dashboards" class="nav-link text-gray-700 font-medium hover:text-indigo-600 transition-colors">Dashboards</a>
                </nav>

                <button class="md:hidden text-gray-700">
                    <i class="fas fa-bars text-xl"></i>
                </button>
            </div>
        </div>
    </header>

    <main class="pt-24 pb-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            
            <!-- Home Button -->
            <a href="/" class="home-button">
                <i class="fas fa-home"></i>
                <span>Inicio</span>
            </a>
            
            <div class="text-center mb-12 fade-in">
                <h1 class="text-4xl font-bold text-gray-900 mb-4">
                    Exploratory Data Analysis
                </h1>
                <p class="text-xl text-gray-600 max-w-3xl mx-auto">
                    Comprehensive exploration of the BigMart dataset to understand patterns, distributions,
                    and variable characteristics before modeling.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-12 fade-in">
                <div class="info-card">
                    <div class="flex items-center justify-between mb-2">
                        <i class="fas fa-database text-2xl"></i>
                        <span class="text-sm font-medium">Records</span>
                    </div>
                    <div class="text-3xl font-bold">-</div>
                    <div class="text-sm text-gray-200">Total records</div>
                </div>

                <div class="info-card">
                    <div class="flex items-center justify-between mb-2">
                        <i class="fas fa-columns text-2xl"></i>
                        <span class="text-sm font-medium">Variables</span>
                    </div>
                    <div class="text-3xl font-bold">-</div>
                    <div class="text-sm text-gray-200">Total columns</div>
                </div>

                <div class="info-card">
                    <div class="flex items-center justify-between mb-2">
                        <i class="fas fa-copy text-2xl"></i>
                        <span class="text-sm font-medium">Duplicates</span>
                    </div>
                    <div class="text-3xl font-bold">-</div>
                    <div class="text-sm text-gray-200">Duplicate records</div>
                </div>

                <div class="info-card">
                    <div class="flex items-center justify-between mb-2">
                        <i class="fas fa-exclamation-triangle text-2xl"></i>
                        <span class="text-sm font-medium">Nulls</span>
                    </div>
                    <div class="text-3xl font-bold">-</div>
                    <div class="text-sm text-gray-200">Columns with missing values</div>
                </div>
            </div>

            <div class="carousel-container fade-in delay-1">
                <div class="carousel-track" id="carouselTrack">
                    <div class="carousel-slide">
                        <div class="chart-container">
                            <h3 class="text-2xl font-bold text-gray-900 mb-4">Dataset Overview</h3>
                            <p class="text-gray-600 mb-6">
                                The BigMart dataset contains detailed information about products and sales
                                across different stores. Variables include product characteristics
                                (weight, fat content, visibility, price) and store characteristics
                                (size, location, outlet type).
                            </p>
                            <div class="grid grid-cols-2 gap-6">
                                <div class="bg-blue-50 p-4 rounded-lg">
                                    <h4 class="font-semibold text-blue-900 mb-2">Numerical Variables</h4>
                                    <ul class="text-sm text-blue-700 space-y-1">
                                        <li>• Item_Weight (Product Weight)</li>
                                        <li>• Item_Visibility (In-store Visibility)</li>
                                        <li>• Item_MRP (Maximum Retail Price)</li>
                                        <li>• Item_Outlet_Sales (Product Sales)</li>
                                        <li>• Outlet_Establishment_Year (Year Established)</li>
                                    </ul>
                                </div>
                                <div class="bg-green-50 p-4 rounded-lg">
                                    <h4 class="font-semibold text-green-900 mb-2">Categorical Variables</h4>
                                    <ul class="text-sm text-green-700 space-y-1">
                                        <li>• Item_Fat_Content (Fat Content)</li>
                                        <li>• Item_Type (Product Type)</li>
                                        <li>• Outlet_Size (Store Size)</li>
                                        <li>• Outlet_Location_Type (Location Tier)</li>
                                        <li>• Outlet_Type (Store Type)</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="carousel-slide">
                        <div class="chart-container">
                            <h3 class="text-2xl font-bold text-gray-900 mb-4">Missing Values Analysis</h3>
                            <div id="missingValuesChart" style="height: 400px;"></div>
                            <div class="mt-4 p-4 bg-yellow-50 rounded-lg">
                                <h4 class="font-semibold text-yellow-900 mb-2">Observations:</h4>
                                <ul class="text-sm text-yellow-800 space-y-1">
                                    <li>• <strong>Item_Weight:</strong> Imputed using the mean weight per product type.</li>
                                    <li>• <strong>Outlet_Size:</strong> Imputed using the mode based on store type.</li>
                                    <li>• Imputation strategy designed to preserve natural business patterns.</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="carousel-slide">
                        <div class="chart-container">
                            <h3 class="text-2xl font-bold text-gray-900 mb-4">Product Weight Distribution</h3>
                            <div id="weightDistribution" style="height: 400px;"></div>
                            <div class="mt-4 p-4 bg-blue-50 rounded-lg">
                                <h4 class="font-semibold text-blue-900 mb-2">Insights:</h4>
                                <ul class="text-sm text-blue-800 space-y-1">
                                    <li>• Approximately normal distribution with a slight positive skew.</li>
                                    <li>• Main concentration found in the mid-weight range.</li>
                                    <li>• Presence of strategically imputed missing values.</li>
                                    <li>• Variability reflects the diversity of product types.</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="carousel-slide">
                        <div class="chart-container">
                            <h3 class="text-2xl font-bold text-gray-900 mb-4">Price Distribution (MRP)</h3>
                            <div id="mrpDistribution" style="height: 400px;"></div>
                            <div class="mt-4 p-4 bg-green-50 rounded-lg">
                                <h4 class="font-semibold text-green-900 mb-2">Insights:</h4>
                                <ul class="text-sm text-green-800 space-y-1">
                                    <li>• Relatively uniform distribution across the price range.</li>
                                    <li>• Multiple peaks suggest different product categories/tiers.</li>
                                    <li>• Basis for segmentation into Economy, Standard, and Premium.</li>
                                    <li>• Wide price variability reflects the diversity of the catalog.</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="carousel-slide">
                        <div class="chart-container">
                            <h3 class="text-2xl font-bold text-gray-900 mb-4">Distribution by Product Type</h3>
                            <div id="itemTypeDistribution" style="height: 400px;"></div>
                            <div class="mt-4 p-4 bg-purple-50 rounded-lg">
                                <h4 class="font-semibold text-purple-900 mb-2">Insights:</h4>
                                <ul class="text-sm text-purple-800 space-y-1">
                                    <li>• 16 different product categories in the catalog.</li>
                                    <li>• Relatively balanced distribution among categories.</li>
                                    <li>• Basis for creating macro-categories (Food, Drinks, Non-Consumable).</li>
                                    <li>• Allows for analysis of preferences by store type.</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="carousel-slide">
                        <div class="chart-container">
                            <h3 class="text-2xl font-bold text-gray-900 mb-4">Fat Content (After Cleanup)</h3>
                            <div id="fatContentChart" style="height: 400px;"></div>
                            <div class="mt-4 p-4 bg-red-50 rounded-lg">
                                <h4 class="font-semibold text-red-900 mb-2">Applied Correction:</h4>
                                <ul class="text-sm text-red-800 space-y-1">
                                    <li>• Standardized inconsistent categories: LF → Low Fat, reg → Regular.</li>
                                    <li>• Identified Non-Edible category for household/non-food items.</li>
                                    <li>• Significant improvement in data quality and consistency.</li>
                                    <li>• Enables more accurate analysis of consumption preferences.</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="carousel-slide">
                        <div class="chart-container">
                            <h3 class="text-2xl font-bold text-gray-900 mb-4">Feature Engineering</h3>
                            <div class="grid grid-cols-2 gap-6">
                                <div class="bg-indigo-50 p-6 rounded-lg">
                                    <h4 class="font-semibold text-indigo-900 mb-4">New Variables Created</h4>
                                    <ul class="text-sm text-indigo-800 space-y-2">
                                        <li>• <strong>Broad_Category:</strong> Grouping 16 types into 3 macro-categories (Food, Drinks, Non-Consumable).</li>
                                        <li>• <strong>Years_Established:</strong> Store age calculated as 2013 - Establishment Year.</li>
                                        <li>• <strong>Price_Tier:</strong> Product classification into Economy, Standard, and Premium.</li>
                                    </ul>
                                </div>
                                <div class="bg-orange-50 p-6 rounded-lg">
                                    <h4 class="font-semibold text-orange-900 mb-4">Applied Transformations</h4>
                                    <ul class="text-sm text-orange-800 space-y-2">
                                        <li>• <strong>Encoding:</strong> One-Hot Encoding for nominal categorical variables.</li>
                                        <li>• <strong>Scaling:</strong> StandardScaler (Z-score) for numerical variables.</li>
                                        <li>• <strong>Imputation:</strong> Mean by product type for weight, Mode for store size.</li>
                                        <li>• <strong>Cleaning:</strong> Standardization of Item_Fat_Content (LF → Low Fat).</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                                <h4 class="font-semibold text-gray-900 mb-2">Preprocessing Pipeline</h4>
                                <div class="grid grid-cols-3 gap-4 text-center">
                                    <div>
                                        <div class="text-lg font-bold text-blue-600">Cleaning</div>
                                        <div class="text-sm text-gray-600">Data standardization</div>
                                    </div>
                                    <div>
                                        <div class="text-lg font-bold text-green-600">Transformation</div>
                                        <div class="text-sm text-gray-600">Encoding & Scaling</div>
                                    </div>
                                    <div>
                                        <div class="text-lg font-bold text-purple-600">Modeling</div>
                                        <div class="text-sm text-gray-600">Ready for K-Means</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <button class="carousel-btn prev" onclick="changeSlide(-1)">
                    <i class="fas fa-chevron-left text-gray-700"></i>
                </button>
                <button class="carousel-btn next" onclick="changeSlide(1)">
                    <i class="fas fa-chevron-right text-gray-700"></i>
                </button>

                <div class="slide-indicator">
                    <div class="indicator-dot active" onclick="goToSlide(0)"></div>
                    <div class="indicator-dot" onclick="goToSlide(1)"></div>
                    <div class="indicator-dot" onclick="goToSlide(2)"></div>
                    <div class="indicator-dot" onclick="goToSlide(3)"></div>
                    <div class="indicator-dot" onclick="goToSlide(4)"></div>
                    <div class="indicator-dot" onclick="goToSlide(5)"></div>
                    <div class="indicator-dot" onclick="goToSlide(6)"></div>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-gray-900 text-white py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <div class="flex items-center justify-center space-x-3 mb-4">
                    <div class="w-8 h-8 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center">
                        <i class="fas fa-chart-line text-white text-sm"></i>
                    </div>
                    <span class="text-lg font-semibold">BigMart Analytics</span>
                </div>
                <p class="text-gray-400 text-sm">
                    © 2024 Business Intelligence Project. All rights reserved.
                </p>
            </div>
        </div>
    </footer>

    <script>
        let currentSlide = 0;
        const totalSlides = 7;
        const API_BASE = '/business-intelligence/bigmart-analisys';

        function changeSlide(direction) {
            currentSlide += direction;
            if (currentSlide < 0) currentSlide = totalSlides - 1;
            if (currentSlide >= totalSlides) currentSlide = 0;
            updateCarousel();
        }

        function goToSlide(slideIndex) {
            currentSlide = slideIndex;
            updateCarousel();
        }

        function updateCarousel() {
            const track = document.getElementById('carouselTrack');
            const dots = document.querySelectorAll('.indicator-dot');

            track.style.transform = `translateX(-${currentSlide * 100}%)`;

            dots.forEach((dot, index) => {
                dot.classList.toggle('active', index === currentSlide);
            });
            // Force redraw of Plotly charts when slide changes to ensure correct sizing
            window.dispatchEvent(new Event('resize'));
        }

        // Load EDA Summary
        async function loadEDASummary() {
            try {
                const response = await fetch(`${API_BASE}/eda/summary`);
                const data = await response.json();
                
                // Update info cards
                document.querySelector('.info-card:nth-child(1) .text-3xl').textContent = data.total_rows.toLocaleString();
                document.querySelector('.info-card:nth-child(2) .text-3xl').textContent = data.total_cols;
                document.querySelector('.info-card:nth-child(3) .text-3xl').textContent = data.duplicates;
                document.querySelector('.info-card:nth-child(4) .text-3xl').textContent = Object.keys(data.missing_values).length;
            } catch (error) {
                console.error('Error loading EDA summary:', error);
            }
        }

        // Load Missing Values Chart
        async function loadMissingValuesChart() {
            try {
                const response = await fetch(`${API_BASE}/eda/missing-values-chart`);
                const result = await response.json();
                
                const missingData = [{
                    x: result.data.map(d => d.column),
                    y: result.data.map(d => d.count),
                    type: 'bar',
                    text: result.data.map(d => `${d.percentage}%`),
                    textposition: 'auto',
                    marker: {
                        color: ['#ef4444', '#f97316']
                    }
                }];

                Plotly.newPlot('missingValuesChart', missingData, {
                    title: 'Missing Values by Column',
                    xaxis: { title: 'Columns' },
                    yaxis: { title: 'Missing Value Count' },
                    margin: { t: 40, b: 80, l: 60, r: 40 }
                });
            } catch (error) {
                console.error('Error loading missing values chart:', error);
            }
        }

        // Load Numeric Distributions
        async function loadNumericDistributions() {
            try {
                const response = await fetch(`${API_BASE}/eda/distributions-numeric`);
                const data = await response.json();
                
                // Weight Distribution
                const weightData = [{
                    x: data.Item_Weight,
                    type: 'histogram',
                    nbinsx: 30,
                    marker: { color: '#3b82f6' }
                }];

                Plotly.newPlot('weightDistribution', weightData, {
                    title: 'Product Weight Distribution',
                    xaxis: { title: 'Weight (units)' },
                    yaxis: { title: 'Frequency' },
                    margin: { t: 40, b: 60, l: 60, r: 40 }
                });

                // MRP Distribution
                const mrpData = [{
                    x: data.Item_MRP,
                    type: 'histogram',
                    nbinsx: 40,
                    marker: { color: '#10b981' }
                }];

                Plotly.newPlot('mrpDistribution', mrpData, {
                    title: 'MRP Price Distribution',
                    xaxis: { title: 'MRP Price ($)' },
                    yaxis: { title: 'Frequency' },
                    margin: { t: 40, b: 60, l: 60, r: 40 }
                });
            } catch (error) {
                console.error('Error loading numeric distributions:', error);
            }
        }

        // Load Categorical Distributions
        async function loadCategoricalDistributions() {
            try {
                const response = await fetch(`${API_BASE}/eda/distributions-categorical`);
                const data = await response.json();
                
                // Product Type Distribution
                const itemTypeData = [{
                    labels: data.Item_Type.labels,
                    values: data.Item_Type.values,
                    type: 'pie',
                    marker: {
                        colors: ['#8b5cf6', '#06b6d4', '#10b981', '#f59e0b', '#ef4444', '#ec4899', 
                                '#14b8a6', '#f43f5e', '#8b5cf6', '#06b6d4', '#10b981', '#f59e0b',
                                '#ef4444', '#ec4899', '#14b8a6', '#f43f5e']
                    }
                }];

                Plotly.newPlot('itemTypeDistribution', itemTypeData, {
                    title: 'Distribution by Product Type (%)',
                    margin: { t: 40, b: 40, l: 40, r: 40 }
                });
            } catch (error) {
                console.error('Error loading categorical distributions:', error);
            }
        }

        // Load Fat Content Analysis
        async function loadFatContentChart() {
            try {
                const response = await fetch(`${API_BASE}/eda/fat-content-cleanup`);
                const data = await response.json();
                
                // Show data AFTER correction
                const fatData = [{
                    x: data.after.labels,
                    y: data.after.values,
                    type: 'bar',
                    marker: {
                        color: ['#22c55e', '#f97316', '#3b82f6']
                    }
                }];

                Plotly.newPlot('fatContentChart', fatData, {
                    title: 'Fat Content Distribution (After Cleanup)',
                    xaxis: { title: 'Content Type' },
                    yaxis: { title: 'Product Count' },
                    margin: { t: 40, b: 60, l: 60, r: 40 }
                });
            } catch (error) {
                console.error('Error loading Fat Content chart:', error);
            }
        }

        // Initialize charts
        document.addEventListener('DOMContentLoaded', function () {
            // Load all data from backend
            loadEDASummary();
            loadMissingValuesChart();
            loadNumericDistributions();
            loadCategoricalDistributions();
            loadFatContentChart();
        });
    </script>
    <script>
        document.addEventListener('keydown', e => {
            if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                window.parent.postMessage('go-next', '*');
            } else if (e.key === 'ArrowLeft') {
                e.preventDefault();
                window.parent.postMessage('go-prev', '*');
            }
        });
    </script>
</body>
</html>